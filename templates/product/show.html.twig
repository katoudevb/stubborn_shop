{% extends 'base.html.twig' %}

{% block title %}
    {{ product.name }}
{% endblock %}

{% block body %}
<div class="product-card" style="display:flex; gap:2em; padding:1em; border:1px solid #ccc; border-radius:8px; max-width:700px;">

    <!-- Image du produit -->
    <div class="product-image">
        <img src="{{ asset('images/clothes/' ~ product.image) }}" alt="{{ product.name }}" style="max-width:250px; border-radius:8px;">
    </div>

    <!-- Détails du produit -->
    <div class="product-details" style="flex:1; display:flex; flex-direction:column; gap:1em;">
        <h1>{{ product.name }}</h1>
        <p style="font-weight:bold;">Prix : {{ product.price }}€</p>

        <!-- Card imbriquée pour le formulaire -->
        <div class="form-card" style="border:1px solid #ccc; padding:1em; border-radius:8px; max-width:300px;">
            <h3>Taille</h3>

            {% if availableSizes is not empty %}
                <form method="post">
                    <label for="size">Choisir la taille :</label>
                    <select name="size" id="size" required style="margin-bottom:1em; display:block;">
                        {% for size in availableSizes %}
                            {% set stockAvailable = product.getStockBySize(size) - (app.session.get('cart')[product.id][size]|default(0)) %}
                            <option value="{{ size }}" {% if stockAvailable <= 0 %}disabled{% endif %}>
                                {{ size }} {% if stockAvailable > 0 %} ({{ stockAvailable }} en stock) {% else %} (Rupture) {% endif %}
                            </option>
                        {% endfor %}
                    </select>

                    <button type="submit" style="margin-top:0.5em;">Ajouter au panier</button>
                </form>
            {% else %}
                <p>Aucune taille disponible pour ce produit.</p>
            {% endif %}
        </div>

        <form method="post" action="{{ path('app_product_delete', {'id': product.id}) }}">
            <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ product.id) }}">
            <button type="submit" class="btn btn-danger">Supprimer</button>
        </form>


        <!-- Lien retour -->
        <p><a href="{{ path('app_products') }}">Retour aux produits</a></p>

        <!-- Flash messages -->
        {% for message in app.flashes('success') %}
            <div style="color: green; font-weight: bold;">{{ message }}</div>
        {% endfor %}
        {% for message in app.flashes('error') %}
            <div style="color: red; font-weight: bold;">{{ message }}</div>
        {% endfor %}
    </div>
</div>
{% endblock %}
